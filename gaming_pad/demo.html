<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css" type="text/css" media="screen" title="no title" charset="utf-8" />
  </head>
  <body>
    <div id="canvas_wrapper">
      <canvas id="game_canvas" width="480" height="320">
        &lt;canvas&gt; isn't supported by your browser..sorry..
      </canvas>
  </body>

  <script type="text/javascript">
    // declare canvas variable and use 2d context
    var canvas  = document.getElementById('game_canvas');
    var context = canvas.getContext('2d');

    // buttons and there current state, default false;
    var d_pad_up    = false;
    var d_pad_down  = false;
    var d_pad_left  = false;
    var d_pad_right = false;
    var button_one  = false;

    // square that can be controlled
    var box_x_position = 100;
    var box_y_position = 100;
    var box_colour     = "#eee";
    var colours        = ["#333", "#F5A", "#000", "#369", "#F00", "#0FF"]

    // draw a d-pad styled button onto the canvas
    // context:    the canvas context
    // direction:  "up", "down", "left", "right"
    // x_position: X-Axis on canvas where the button should be rendered
    // y_position: Y-Axis on canvas where the button should be rendered
    // size:       Size of button, eg. 50 will draw a square 50px*50px
    // active:     Boolean if the key is currently active
    function drawDirectionButton(context, direction, x_position, y_position, size, active){
      context.fillStyle = "rgba(0, 0, 0, 0.2)";
      context.fillRect(x_position, y_position, size, size);

      mid_point = size / 2.0;
      spacer    = size / 10.0;

      if(active){ context.fillStyle = "rgba(0, 255, 0, 0.2)"; }
      else{ context.fillStyle = "rgba(0, 0, 0, 0.2)"; }
      context.beginPath();

      switch (direction){
        case "up":
          context.moveTo(x_position + mid_point, y_position + spacer);
          context.lineTo(x_position + size - spacer, y_position + size - spacer);
          context.lineTo(x_position + spacer, y_position + size - spacer);
        break;
        case "down":
          context.moveTo(x_position + mid_point, y_position + size - spacer);
          context.lineTo(x_position + size - spacer, y_position + spacer);
          context.lineTo(x_position + spacer, y_position + spacer);
        break;
        case "left":
          context.moveTo(x_position + spacer, y_position + mid_point);
          context.lineTo(x_position + size - spacer, y_position + spacer);
          context.lineTo(x_position + size - spacer, y_position + size - spacer);
        break;
        case "right":
          context.moveTo(x_position + size - spacer,  y_position + mid_point);
          context.lineTo(x_position + spacer, y_position + spacer);
          context.lineTo(x_position + spacer, y_position + size - spacer);
        break;
      };

      // Fill triangle can close path
      context.fill();
      context.closePath();
    }

    // draws a D-Pad on the canvas..though it doesn't actually do anything..
    function drawDPad(context, x_position, y_position, overall_size){
      button_size = overall_size / 3.0;

      drawDirectionButton(context, 'up', x_position + button_size, y_position, button_size, d_pad_up);
      drawDirectionButton(context, 'down', x_position + button_size, y_position + overall_size - button_size, button_size, d_pad_down);
      drawDirectionButton(context, 'left', x_position,  y_position + button_size, button_size, d_pad_left);
      drawDirectionButton(context, 'right', x_position + overall_size - button_size, y_position + button_size, button_size, d_pad_right);
    }

    function drawButton(context, x_position, y_position, size, label, button_var){
      mid_point = size / 2.0
      spacer = size / 10.0

      if(button_var){ context.fillStyle = "rgba(0, 255, 0, 0.2)"; }
      else{ context.fillStyle = "rgba(0, 0, 0, 0.2)"; }
      context.fillRect(x_position, y_position, size, size);

      context.fillStyle = "rgba(0, 0, 0, 0.2)";
      context.font = "16px sans-serif";
      context.fillText(label, x_position + spacer, y_position + mid_point - spacer);
    }

    // copy + paste job just so I can spit out notices
    function drawNotices(context){
      context.font = "10px sans-serif";
       context.fillStyle = "rgba(255, 0, 0, 0.8)";
      num_notices = 0;
      if(d_pad_up){
        num_notices += 1;
        context.fillText("PRESSED UP", 10, 10 + (10*num_notices));
      }
      if(d_pad_down){
        num_notices += 1;
        context.fillText("PRESSED DOWN", 10, 10 + (10*num_notices));
      }
      if(d_pad_left){
        num_notices += 1;
        context.fillText("PRESSED LEFT", 10, 10 + (10*num_notices));
      }
      if(d_pad_right){
        num_notices += 1;
        context.fillText("PRESSED RIGHT", 10, 10 + (10*num_notices));
      }
      if(button_one){
        num_notices += 1;
        context.fillText("BUTTON 1", 10, 10 + (10*num_notices));
      }
    }

    function drawBox(context){
      context.fillStyle = box_colour;
      context.fillRect(box_x_position, box_y_position, 50, 50);
    }

    function keyPressDown(event)
    {
      switch(event.keyCode){
        case 32: // spacebar
          button_one = true; break;
        case 37:
          d_pad_left = true; break;
        case 38:
          d_pad_up = true; break;
        case 39:
          d_pad_right = true; break;
        case 40:
          d_pad_down = true; break;
      };
    };

    function keyPressUp(event)
    {
      switch(event.keyCode){
        case 32: // spacebar
          button_one = false; break;
        case 37:
          d_pad_left = false; break;
        case 38:
          d_pad_up = false; break;
        case 39:
          d_pad_right = false; break;
        case 40:
          d_pad_down = false; break;
      };
    };

    function tick(){
      context.clearRect(0,0, 480, 320);

      if(button_one){
        box_colour = colours[Math.floor(Math.random()*7)];
      }
      if(d_pad_up){
        box_y_position = box_y_position - 2;
      }
      if(d_pad_down){
        box_y_position = box_y_position + 2;
      }
      if(d_pad_left){
        box_x_position = box_x_position - 2;
      }
      if(d_pad_right){
        box_x_position = box_x_position + 2;
      }

      drawBox(context);

      drawNotices(context);

      // Draw controls last
      drawDPad(context, 10, 210, 100);
      drawButton(context, 410, 235, 50, "1", button_one);
    }

    function init(){
      // attach listeners for keyboard presses
      window.addEventListener('keydown', keyPressDown, true)
      window.addEventListener('keyup',   keyPressUp, true)

      // start game tick
      setInterval(tick, 50);
    }

    window.onload = init;
  </script>
</html>
